# Oppsummering av dataflyten fra vannforskriften til naturindeks

Med [naturindeksen](https://www.naturindeks.no/) og [vannforskriften](https://lovdata.no/dokument/SF/forskrift/2006-12-15-1446) (jf. [klassifiseringsveilederen](https://www.vannportalen.no/veiledere/klassifiseringsveileder/)) har Norge to rammeverk som rapporterer tilstanden for ferskvanns- og kystvannsystemer.
Naturindeksen har tatt i bruk flere ferskvanns- og kystvannsindikatorer som også inngår i vannforskriften ([Schartau mfl. 2016](http://hdl.handle.net/11250/2384734)).
Det bør være et mål at disse indikatorene gir mest mulig sammenfallende beskrivelser i begge rammeverkene. 
Basert på tidligere analyser og anbefalinger om samordning ([Schartau mfl. 2016](http://hdl.handle.net/11250/2384734), [Gundersen mfl. 2018](http://hdl.handle.net/11250/2584222)) har Sandvik ([2019](http://hdl.handle.net/11250/2631056)) beskrevet en dataflyt av data som er samla inn i sammenheng med vannforskriften, til naturindeks.
Når vannforskriftsdata skal benyttes i rammen av et økologisk tilstandsregnskap ([Fremstad mfl. 2023](https://hdl.handle.net/11250/3104185)), kan det være aktuelt å følge samme fremgangsmåte.
Denne dataflyten kan sammenfattes i 16 trinn ([Sandvik 2019](http://hdl.handle.net/11250/2631056), s. 11):

1. _Målinger leses inn fra [vannmiljø](https://vannmiljo.miljodirektoratet.no/)-databasen._ Dette trinnet krever inntil videre en manuell nedlasting av målinger, siden vannmiljø ikke er tilrettelagt for maskinell innlesing av målingene. Etter nedlasting må funksjonen [`lesMaalinger`](lesMaalinger.md) brukes for å tilrettelegge datasettet for de neste trinnene.
2. _Målinger som ligger utafor rapporteringsperiodene for naturindeksen, fjernes._ Trinnene 2 til 15 gjennomføres av funksjonen [`fraVFtilNI`](fraVFtilNI.md).
3. _Målinger med verdier som ligger utafor indikatorens verdiområde, fjernes._ Vannmiljø-databasen inneholder en del måleverdier som ikke er forenlig med de respektive vannforskriftsparameternes definisjon. Disse er altså feilrapporteringer og ekskluderes. I tillegg kan man ekskludere målinger som er tatt av samme oppdragstager på samme dato.
4. _Målingene kobles til vannlokaliteter._ Målinger som ikke er tatt i en kjent vannlokalitet, blir ekskludert. (Vannlokalitetene må først ha blitt lest inn ved hjelp av funksjonen [`lesVannlokaliteter`](lesVannlokaliteter.md).)
5. _Vannlokalitetene kobles til vannforekomster._ Målinger som er tatt i en vannlokalitet som ikke hører til noen kjent vannforekomst, blir ekskludert. (Vannforekomstene må først ha blitt lest inn ved hjelp av funksjonen [`lesVannforekomster`](lesVannforekomster.md).)
6. _Vannforekomstene kobles til innsjønumre (bare relevant for innsjøer)._ Funksjonen [`oppdaterVannforekomster`](oppdaterVannforekomster.md) oppdaterer og eventuelt korrigerer informasjon om innsjøvannforekomster med informasjon fra [NVEs innsjødatabase](https://www.nve.no/kart/kartdata/vassdragsdata/innsjodatabase/), f.eks. areal og høyde over havet (som først må ha blitt lest inn ved hjelp av funksjonen [`lesInnsjodatabasen`](lesInnsjodatabasen.md)).
7. _Målinger som er tatt i en vannkategori som indikatoren ikke er definert for, fjernes._ Når f.eks. en vannforskriftsparameter som er definert for elver, blir målt i en innsjø, blir denne målinga ekskludert. 
8. _Målinger som er tatt i en vanntype der indikatorens klassegrenser ikke er definert, fjernes._ Når f.eks. en vannforskriftsparameter som er definert for kalkfattige innsjøer, blir målt i en kalkrik innsjø, blir denne målinga ekskludert. Visse andre [parameterspesifikke krav](param.md#spesielle-krav-til-de-ulike-vannforskriftsparameterne) kan også testes, og målinger som ikke oppfyller disse kravene, fjernes (fra og med versjon 1.2).
9. _Hvis antallet målinger i en rapporteringsperiode er for lite, fjernes målingene._ Det trengs et visst minstetall av målinger for å estimere tilstanden i en rapporteringsperiode. Hvis det er tatt færre målinger, utgår denne rapporteringsperioden og de respektive målingene.
10. _Måleverdiene skaleres til ikke-trunkerte nEQR-verdier («mEQR-verdier»)._ Vannforskriften regner om målinger til såkalte **nEQR-verdier** («normaliserte økologiske kvalitetskvotienter»), som har verdier mellom 0 og 1. Denne skaleringa innebærer trunkering av måleverdier som er bedre enn referansetilstanden, til 1 og av måleverdier som er dårligere enn nedre grense for «svært dårlig tilstand», til 0. Slik trunkering skjuler imidlertid kunnskap om variasjon, som er viktig for naturindeksen. Sandvik ([2019](http://hdl.handle.net/11250/2631056), s. 13–15) har derfor foreslått at dataflyten mellom vannforskriften og naturindeks bør baseres på EQR-verdier som er _skalert, men ikke trunkert_, og kaller slike verdier for _mEQR-verdier_ (se [kort forklaring](mEQR.md) og [utdypende forklaring](asympEQR.md)).
11. _Det tilpasses en lineær modell til målingene._ Variasjonen mellom målingene forsøkes forklart gjennom en modell som bruker rapporteringsperioder, typologifaktorer og overvåkingsaktiviteter som forklaringsvariabler (se [utdypende forklaring](modell.md)).
12. _Uvekta gjennomsnitt av målinger innafor en vannforekomst bestemmer dennes verdi._ Hvis det er tatt flere målinger i samme vannforekomst i samme rapporteringsperiode, settes verdien for denne vannforekomsten til det uvekta gjennomsnittet av disse målingene.
13. _Ekstrapolering av mEQR-verdier til vannforekomster som det ikke fins målinger fra._ Hvis det _ikke_ er tatt målinger i en vannforekomst, predikeres den mest trolige verdien basert på modellen som ble tilpassa i trinn 11 (se [utdypende forklaring](extrapol.md)).
14. _Simulering basert på konfidens-/prediksjonsintervaller for å kvantifisere usikkerheten._ Basert på den tilpassa modellen kvantifiseres usikkerheten ved hjelp av en simulering som genererer slumptall basert på konfidensintervaller for vannforekomster som det er tatt målinger i, og basert på prediksjonsintervaller for vannforekomster som det ikke er tatt målinger i. (Frem til versjon 1.4 ble det brukt prediksjonsintervaller for alle vannforekomster.)
15. _Aggregering av vannforekomstenes verdier for geografiske enheter som gjennomsnitt._ Vannforekomstenes verdier aggregeres for kommuner, fylker, landsdeler og/eller hele landet. Aggregeringa er basert på gjennomsnitt som er vekta med vannforekomstenes areal (se [utdypende forklaring](arealvekt.md)). Dette trinnet er det siste som gjennomføres av funksjonen [`fraVFtilNI`](fraVFtilNI.md).
16. _Uvekta gjennomsnitt av de aggregerte verdiene for ulike vannkategorier._ Dette trinnet er bare relevant for de få vannforskriftsparameterne som er definert for både innsjøer og elver, og det gjennomføres av funksjonen [`kombiner`](kombiner.md). Forutsatt at funksjonen `fraVFtilNI` har blitt kjørt separat for innsjøer og elver, kombinerer `kombiner` utmatingene fra begge kjøringene.

For nærmere forklaringer anbefales å se på
* [en praktisk demonstrasjon av dataflyten](../vfNIdemo.md),
* [forklaringer av **R**-funksjonene som inngår i dataflyten](funksjon.md),
* [oversikten over hvilke og hvordan vannforskriftsparametere (som) er tilpassa til dataflyten](param.md) og/eller
* [rapporten som beskriver dataflyten](http://hdl.handle.net/11250/2631056).
